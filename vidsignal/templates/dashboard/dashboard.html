{% extends 'base.html' %}

{% block header %}
  <h1>{% block title %}Analytics{% endblock %}</h1>
  <!-- Include the Plotly JavaScript library -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <h2>Welcome - {% if logged_in %}{{g.user.username}}{% else %}Guest{% endif %}</h2>
{% endblock %} 

{% block content %}
<h1>Select a channel</h1>
<select id="channelSelect">
  {% for channel in data['channels'] %}
  <option value="{{ channel['channel_id'] }}"
          data-channel-name="{{ channel['name'] }}"
          data-published-date="{{ channel['published_date'] }}"
          data-thumbnail-uri="{{ channel['thumbnail_uri'] }}">
      {{ channel.name }}
  </option>
  {% endfor %}
</select>
<h2 id="channelDataTitle" style="display: none">Channel Data</h2>
<div id="channelData">
  <p class="channel-info"><strong>Channel name:</strong> <span id="channelName"></span></p>
  <p class="channel-info"><strong>Published date:</strong> <span id="publishedDate"></span></p>
  <img class="channel-info" id="thumbnailImage" src="" alt="Channel Thumbnail" style="max-width: 300px;">  
</div>

<script>
    var channelInfoElements = document.querySelectorAll(".channel-info");
    channelInfoElements.forEach(function(element) {
      element.style.display = "none";
    }); 
    var channelSelect = document.getElementById("channelSelect");
    var channelDataTitle = document.getElementById("channelDataTitle");

   // Add the listener 
   channelSelect.addEventListener('change', function() {
       var selectedChannel = channelSelect.value;
       
       displayChannelData();
       channelInfoElements.forEach(function(element) {
        element.style.display = "block";
      });
      
       // get the data
       fetch('/dashboard/' + String(selectedChannel), {
        method: 'GET',
       })
       .then(response => response.json())
       .then(data => {
          console.log(selectedChannel);         
       })
       .catch(error => console.error(error));

   });
   
   /// this handles showing data that comes in
   function displayChannelData() {
      var channelDataDiv = document.getElementById("channelData");
      var channelSelect = document.getElementById("channelSelect");
      var selectedOption = channelSelect.options[channelSelect.selectedIndex];
      var channelNameElement = document.getElementById("channelName");
      var publishedDateElement = document.getElementById("publishedDate");
      var thumbnailImageElement = document.getElementById("thumbnailImage");
    
      // Get data from the selected option's data attributes
      var channelName = selectedOption.getAttribute("data-channel-name");
      var publishedDate = selectedOption.getAttribute("data-published-date");
      var thumbnailUri = selectedOption.getAttribute("data-thumbnail-uri");
    
      // Update the placeholders with the selected channel's data
      channelNameElement.textContent = channelName;
      publishedDateElement.textContent = publishedDate;
      thumbnailImageElement.src = thumbnailUri;
    
      // Show the 'Channel Data' element
      channelDataTitle.style.display = 'block';
  }

</script>
{% endblock %}

